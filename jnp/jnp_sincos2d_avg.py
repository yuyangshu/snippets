import jax.numpy as jnp


input_size = 224
patch_size = 16

h = w = 14
width = 768
temperature=10_000.

y, x = jnp.mgrid[:h, :w]
omega = jnp.arange(width // 4) / (width // 4 - 1)
omega = 1. / (temperature**omega)

y = jnp.einsum("m,d->md", y.flatten(), omega)
x = jnp.einsum("m,d->md", x.flatten(), omega)

pe = jnp.concatenate([jnp.sin(x), jnp.cos(x), jnp.sin(y), jnp.cos(y)], axis=1)
emb = jnp.asarray(pe, jnp.float32)[None, :, :]
# see jnp_sincos2d.py

emb_2d = jnp.reshape(emb, [h, w, -1])
print("emb_2d", emb_2d, emb_2d.shape)


# fill the embeddings into an image sized matrix
f = lambda i, j, k: emb_2d[i // patch_size, j // patch_size, k]
img = jnp.vectorize(f)(*jnp.indices((224, 224, 768)))
print("emb_2d[0, 0]", emb_2d[0, 0], emb_2d[0, 0].shape)
print(jnp.all(jnp.equal(emb_2d[0, 0], img[0, 0])))
print(jnp.all(jnp.equal(emb_2d[0, 0], img[15, 15])))
print(jnp.all(jnp.equal(emb_2d[13, 13], img[208, 208])))
print(jnp.all(jnp.equal(emb_2d[13, 13], img[223, 223])))


# calculate weighted embedding for each scale
scales = [16, 32, 64, 128]
mean_embs = []
for scale in scales:
    h = scale // patch_size # [1, 2, 4, 8]
    field_size = input_size // h # [224, 112, 56, 28]
    ratio = field_size / patch_size # [14.0, 7.0, 3.5, 1.75]
    print(f"scale: {scale}, h: {h}, field_size: {field_size}, ratio: {ratio, input_size / scale}")

    f = lambda x: jnp.asarray(jnp.split(x, h, axis=1))
    emb_at_scale = f(f(img))

    if (scale == 16):
        print("emb_at_scale", emb_at_scale, emb_at_scale.shape)
        print("img", img, img.shape)
        print(jnp.all(jnp.equal(emb_at_scale[0, 0], img)))

    if (scale == 32):
        print("emb_at_scale", emb_at_scale, emb_at_scale.shape)
        print("img[112:223, 112:223, :]", img[112:224, 112:224, :], img[112:224, 112:224, :].shape)
        print(jnp.all(jnp.equal(emb_at_scale[1, 1], img[112:224, 112:224, :])))

    mean_emb = emb_at_scale.mean(axis=(2, 3))
    print(f"mean_emb[{scale}]", mean_emb, mean_emb.shape)

    mean_embs.append(mean_emb)

flat_embs = jnp.concatenate([jnp.reshape(x, (-1, width)) for x in mean_embs + [emb]])
print("flat_embs", flat_embs, flat_embs.shape)










# emb_2d [[[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.841471    0.81511205  0.78831244 ...  1.          1.
#     1.        ]
#   [ 0.90929747  0.9443943   0.97005814 ...  1.          1.
#     1.        ]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  1.          1.
#     1.        ]
#   [-0.53657293 -0.90496594 -0.9951195  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]]

#  [[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.841471    0.81511205  0.78831244 ...  1.          1.
#     1.        ]
#   [ 0.90929747  0.9443943   0.97005814 ...  1.          1.
#     1.        ]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  1.          1.
#     1.        ]
#   [-0.53657293 -0.90496594 -0.9951195  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]]

#  [[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.841471    0.81511205  0.78831244 ...  1.          1.
#     1.        ]
#   [ 0.90929747  0.9443943   0.97005814 ...  1.          1.
#     1.        ]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  1.          1.
#     1.        ]
#   [-0.53657293 -0.90496594 -0.9951195  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]]

#  ...

#  [[ 0.          0.          0.         ...  0.9999993   0.99999934
#     0.9999994 ]
#   [ 0.841471    0.81511205  0.78831244 ...  0.9999993   0.99999934
#     0.9999994 ]
#   [ 0.90929747  0.9443943   0.97005814 ...  0.9999993   0.99999934
#     0.9999994 ]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  0.9999993   0.99999934
#     0.9999994 ]
#   [-0.53657293 -0.90496594 -0.9951195  ...  0.9999993   0.99999934
#     0.9999994 ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999993   0.99999934
#     0.9999994 ]]

#  [[ 0.          0.          0.         ...  0.9999991   0.9999992
#     0.9999993 ]
#   [ 0.841471    0.81511205  0.78831244 ...  0.9999991   0.9999992
#     0.9999993 ]
#   [ 0.90929747  0.9443943   0.97005814 ...  0.9999991   0.9999992
#     0.9999993 ]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  0.9999991   0.9999992
#     0.9999993 ]
#   [-0.53657293 -0.90496594 -0.9951195  ...  0.9999991   0.9999992
#     0.9999993 ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999991   0.9999992
#     0.9999993 ]]

#  [[ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.841471    0.81511205  0.78831244 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.90929747  0.9443943   0.97005814 ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  0.999999    0.99999905
#     0.99999917]
#   [-0.53657293 -0.90496594 -0.9951195  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]] (14, 14, 768)
# emb_2d[0, 0] [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
#  1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.] (768,)
# True
# True
# True
# True
# scale: 16, h: 1, field_size: 224
# scale: 32, h: 2, field_size: 112
# scale: 64, h: 4, field_size: 56
# scale: 128, h: 8, field_size: 28
# emb_at_scale [[[[[ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]]

#    [[ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]]

#    [[ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]]

#    ...

#    [[ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]]

#    [[ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]]

#    [[ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]]]]] (1, 1, 224, 224, 768)
# img [[[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]]

#  [[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]]

#  [[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#     1.        ]]

#  ...

#  [[ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]

#  [[ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]

#  [[ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.          0.          0.         ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]] (224, 224, 768)
# True
# emb_at_scale [[[[[ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]]

#    [[ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]]

#    [[ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     [ 0.          0.          0.         ...  1.          1.
#       1.        ]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  1.          1.
#       1.        ]]

#    ...

#    [[ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]]

#    [[ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]]

#    [[ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.          0.          0.         ...  0.99999976  0.9999998
#       0.9999998 ]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.99999976  0.9999998
#       0.9999998 ]]]


#   [[[ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     [ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     [ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     [ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     [ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     [ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     [ 0.6569866   0.37766436  0.07317832 ...  1.          1.
#       1.        ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  1.          1.
#       1.        ]]

#    ...

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.99999976  0.9999998
#       0.9999998 ]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.99999976  0.9999998
#       0.9999998 ]]]]



#  [[[[ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]]

#    [[ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]]

#    [[ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.          0.          0.         ...  0.9999997   0.9999997
#       0.99999976]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.9999997   0.9999997
#       0.99999976]]

#    ...

#    [[ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]]

#    [[ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]]

#    [[ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.          0.          0.         ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]
#     [-0.2794155  -0.53596455 -0.74117386 ...  0.999999    0.99999905
#       0.99999917]]]


#   [[[ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#       0.99999976]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#       0.99999976]]

#    ...

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]]

#    [[ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#       0.99999917]
#     ...
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]
#     [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#       0.99999917]]]]] (2, 2, 112, 112, 768)
# img[112:223, 112:223, :] [[[ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]]

#  [[ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]]

#  [[ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.9999997   0.9999997
#     0.99999976]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.9999997   0.9999997
#     0.99999976]]

#  ...

#  [[ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]

#  [[ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]

#  [[ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.6569866   0.37766436  0.07317832 ...  0.999999    0.99999905
#     0.99999917]
#   ...
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]] (112, 112, 768)
# True
# mean_emb[16] [[[ 2.10565999e-02 -5.23896469e-03 -4.42922814e-03  2.33647861e-02
#     6.95588142e-02  1.21459842e-01  1.66615739e-01  1.95890546e-01
#     2.04860657e-01  1.93746760e-01  1.66387051e-01  1.28794611e-01
#     8.77273679e-02  4.95343618e-02  1.93848889e-02  8.82501481e-04
#    -4.00753412e-03  5.19014848e-03  2.77394466e-02  6.20224141e-02
#     1.05866179e-01  1.56830490e-01  2.12441191e-01  2.70359427e-01
#     3.28498840e-01  3.85087818e-01  4.38697726e-01  4.88238573e-01
#     5.32937467e-01  5.72302818e-01  6.06085002e-01  6.34232819e-01
#     6.56852961e-01  6.74172521e-01  6.86505377e-01  6.94224000e-01
#     6.97736084e-01  6.97465539e-01  6.93837523e-01  6.87267423e-01
#     6.78152859e-01  6.66867673e-01  6.53758883e-01  6.39144421e-01
#     6.23312354e-01  6.06521904e-01  5.89003325e-01  5.70960224e-01
#     5.52570820e-01  5.33990026e-01  5.15351355e-01  4.96768862e-01
#     4.78339195e-01  4.60143447e-01  4.42248970e-01  4.24710482e-01
#     4.07572448e-01  3.90869826e-01  3.74629200e-01  3.58870298e-01
#     3.43607068e-01  3.28847557e-01  3.14596176e-01  3.00853252e-01
#     2.87616014e-01  2.74879158e-01  2.62635350e-01  2.50875235e-01
#     2.39588320e-01  2.28763103e-01  2.18386844e-01  2.08446622e-01
#     1.98928803e-01  1.89819559e-01  1.81104928e-01  1.72770917e-01
#     1.64803520e-01  1.57188907e-01  1.49913520e-01  1.42963886e-01
#     1.36326969e-01  1.29989937e-01  1.23940371e-01  1.18166208e-01
#     1.12655737e-01  1.07397586e-01  1.02380939e-01  9.75951254e-02
#     9.30300355e-02  8.86759460e-02  8.45233649e-02  8.05633068e-02
#     7.67871290e-02  7.31864870e-02  6.97534233e-02  6.64803460e-02
#     6.33598641e-02  6.03850931e-02  5.75492568e-02  5.48459925e-02
#     5.22691756e-02  4.98129725e-02  4.74718176e-02  4.52403314e-02
#     4.31134403e-02  4.10862900e-02  3.91542315e-02  3.73128392e-02
#     3.55578922e-02  3.38853262e-02  3.22913155e-02  3.07721812e-02
#     2.93244161e-02  2.79446859e-02  2.66298167e-02  2.53767520e-02
#     2.41825860e-02  2.30445731e-02  2.19600778e-02  2.09265817e-02
#     1.99417099e-02  1.90031547e-02  1.81087460e-02  1.72564145e-02
#     1.64441895e-02  1.56701766e-02  1.49325905e-02  1.42297065e-02
#     1.35598974e-02  1.29216081e-02  1.23133594e-02  1.17337396e-02
#     1.11813955e-02  1.06550464e-02  1.01534706e-02  9.67550371e-03
#     9.22003295e-03  8.78600590e-03  8.37240368e-03  7.97826890e-03
#     7.60268793e-03  7.24478392e-03  6.90373033e-03  6.57873368e-03
#     6.26903167e-03  5.97390765e-03  5.69267757e-03  5.42468671e-03
#     5.16931014e-03  4.92595835e-03  4.69405996e-03  4.47307900e-03
#     4.26249998e-03  4.06183396e-03  3.87061480e-03  3.68839991e-03
#     3.51476064e-03  3.34929535e-03  3.19162011e-03  3.04136728e-03
#     2.89818947e-03  2.76175048e-03  2.63173482e-03  2.50783982e-03
#     2.38977699e-03  2.27727275e-03  2.17006565e-03  2.06790469e-03
#     1.97055307e-03  1.87778438e-03  1.78938312e-03  1.70514348e-03
#     1.62487058e-03  1.54837570e-03  1.47548190e-03  1.40601990e-03
#     1.33982813e-03  1.27675245e-03  1.21664675e-03  1.15936995e-03
#     1.10478967e-03  1.05277903e-03  1.00321672e-03  9.55987780e-04
#     9.10982606e-04  8.68095958e-04  8.27228127e-04  7.88284175e-04
#     7.51173764e-04  7.15810282e-04  6.82112062e-04  6.49999885e-04
#     9.55913067e-02  5.85839972e-02  1.10641103e-02 -3.01887505e-02
#    -5.25887199e-02 -5.06420434e-02 -2.59632673e-02  1.46289011e-02
#     6.17760383e-02  1.06080636e-01  1.39919370e-01  1.58404425e-01
#     1.59586474e-01  1.44114181e-01  1.14589065e-01  7.48229846e-02
#     2.91421432e-02 -1.81776360e-02 -6.33149743e-02 -1.03144206e-01
#    -1.35342404e-01 -1.58391327e-01 -1.71509370e-01 -1.74541399e-01
#    -1.67830899e-01 -1.52090862e-01 -1.28284380e-01 -9.75215062e-02
#    -6.09742701e-02 -1.98121890e-02  2.48474348e-02  7.19709471e-02
#     1.20629229e-01  1.70007706e-01  2.19408825e-01  2.68248826e-01
#     3.16051394e-01  3.62438887e-01  4.07120764e-01  4.49883670e-01
#     4.90580827e-01  5.29121399e-01  5.65460980e-01  5.99593580e-01
#     6.31544113e-01  6.61360741e-01  6.89111292e-01  7.14875758e-01
#     7.38744736e-01  7.60814726e-01  7.81185389e-01  7.99958348e-01
#     8.17234397e-01  8.33112597e-01  8.47689390e-01  8.61057639e-01
#     8.73306096e-01  8.84518802e-01  8.94775867e-01  9.04152274e-01
#     9.12717998e-01  9.20538902e-01  9.27676380e-01  9.34186459e-01
#     9.40122485e-01  9.45532620e-01  9.50461864e-01  9.54951704e-01
#     9.59039927e-01  9.62761581e-01  9.66148853e-01  9.69231129e-01
#     9.72035050e-01  9.74585712e-01  9.76905346e-01  9.79014635e-01
#     9.80932593e-01  9.82676089e-01  9.84260976e-01  9.85701561e-01
#     9.87010777e-01  9.88200605e-01  9.89281774e-01  9.90264237e-01
#     9.91156876e-01  9.91967916e-01  9.92704630e-01  9.93373930e-01
#     9.93982077e-01  9.94534373e-01  9.95036066e-01  9.95491803e-01
#     9.95905817e-01  9.96281743e-01  9.96623278e-01  9.96933401e-01
#     9.97215092e-01  9.97470915e-01  9.97703195e-01  9.97914255e-01
#     9.98105943e-01  9.98279929e-01  9.98438120e-01  9.98581588e-01
#     9.98711944e-01  9.98830318e-01  9.98937845e-01  9.99035418e-01
#     9.99123991e-01  9.99204576e-01  9.99277830e-01  9.99344170e-01
#     9.99404430e-01  9.99459088e-01  9.99508917e-01  9.99553978e-01
#     9.99594986e-01  9.99632239e-01  9.99666095e-01  9.99696672e-01
#     9.99724567e-01  9.99749899e-01  9.99772966e-01  9.99793828e-01
#     9.99812722e-01  9.99829948e-01  9.99845624e-01  9.99859750e-01
#     9.99872625e-01  9.99884307e-01  9.99895036e-01  9.99904692e-01
#     9.99913394e-01  9.99921322e-01  9.99928653e-01  9.99935210e-01
#     9.99941111e-01  9.99946594e-01  9.99951422e-01  9.99955893e-01
#     9.99959946e-01  9.99963641e-01  9.99966979e-01  9.99970019e-01
#     9.99972761e-01  9.99975204e-01  9.99977529e-01  9.99979556e-01
#     9.99981463e-01  9.99983191e-01  9.99984741e-01  9.99986112e-01
#     9.99987423e-01  9.99988616e-01  9.99989629e-01  9.99990582e-01
#     9.99991417e-01  9.99992192e-01  9.99992967e-01  9.99993622e-01
#     9.99994218e-01  9.99994695e-01  9.99995232e-01  9.99995649e-01
#     9.99996066e-01  9.99996424e-01  9.99996722e-01  9.99997020e-01
#     9.99997318e-01  9.99997497e-01  9.99997795e-01  9.99997973e-01
#     9.99998093e-01  9.99998271e-01  9.99998450e-01  9.99998748e-01
#     9.99998748e-01  9.99998868e-01  9.99998987e-01  9.99999046e-01
#     9.99999106e-01  9.99999225e-01  9.99999344e-01  9.99999344e-01
#     9.99999464e-01  9.99999523e-01  9.99999523e-01  9.99999583e-01
#     9.99999583e-01  9.99999642e-01  9.99999642e-01  9.99999642e-01
#     2.10565981e-02 -5.23894653e-03 -4.42924257e-03  2.33647972e-02
#     6.95588291e-02  1.21459819e-01  1.66615739e-01  1.95890546e-01
#     2.04860687e-01  1.93746790e-01  1.66387066e-01  1.28794625e-01
#     8.77273530e-02  4.95343618e-02  1.93848778e-02  8.82524473e-04
#    -4.00754390e-03  5.19016385e-03  2.77394373e-02  6.20223694e-02
#     1.05866157e-01  1.56830505e-01  2.12441161e-01  2.70359427e-01
#     3.28498840e-01  3.85087848e-01  4.38697755e-01  4.88238662e-01
#     5.32937467e-01  5.72302759e-01  6.06085002e-01  6.34232700e-01
#     6.56853020e-01  6.74172521e-01  6.86505377e-01  6.94224000e-01
#     6.97735965e-01  6.97465539e-01  6.93837345e-01  6.87267363e-01
#     6.78152859e-01  6.66867852e-01  6.53758883e-01  6.39144361e-01
#     6.23312354e-01  6.06521845e-01  5.89003384e-01  5.70960224e-01
#     5.52570820e-01  5.33990085e-01  5.15351355e-01  4.96768892e-01
#     4.78339136e-01  4.60143447e-01  4.42248970e-01  4.24710453e-01
#     4.07572448e-01  3.90869826e-01  3.74629200e-01  3.58870327e-01
#     3.43607068e-01  3.28847557e-01  3.14596176e-01  3.00853223e-01
#     2.87616044e-01  2.74879158e-01  2.62635350e-01  2.50875205e-01
#     2.39588320e-01  2.28763074e-01  2.18386859e-01  2.08446622e-01
#     1.98928803e-01  1.89819545e-01  1.81104928e-01  1.72770917e-01
#     1.64803520e-01  1.57188937e-01  1.49913520e-01  1.42963886e-01
#     1.36326984e-01  1.29989907e-01  1.23940378e-01  1.18166223e-01
#     1.12655714e-01  1.07397586e-01  1.02380946e-01  9.75951329e-02
#     9.30300355e-02  8.86759460e-02  8.45233724e-02  8.05633068e-02
#     7.67871290e-02  7.31864721e-02  6.97534382e-02  6.64803311e-02
#     6.33598641e-02  6.03850931e-02  5.75492606e-02  5.48459888e-02
#     5.22691794e-02  4.98129688e-02  4.74718250e-02  4.52403314e-02
#     4.31134403e-02  4.10862938e-02  3.91542278e-02  3.73128429e-02
#     3.55578959e-02  3.38853262e-02  3.22913155e-02  3.07721794e-02
#     2.93244142e-02  2.79446878e-02  2.66298205e-02  2.53767483e-02
#     2.41825897e-02  2.30445713e-02  2.19600722e-02  2.09265798e-02
#     1.99417118e-02  1.90031528e-02  1.81087442e-02  1.72564145e-02
#     1.64441895e-02  1.56701785e-02  1.49325905e-02  1.42297065e-02
#     1.35598956e-02  1.29216071e-02  1.23133585e-02  1.17337396e-02
#     1.11813955e-02  1.06550455e-02  1.01534715e-02  9.67550278e-03
#     9.22003295e-03  8.78600497e-03  8.37240368e-03  7.97826890e-03
#     7.60268746e-03  7.24478392e-03  6.90372987e-03  6.57873368e-03
#     6.26903167e-03  5.97390719e-03  5.69267757e-03  5.42468671e-03
#     5.16931014e-03  4.92595835e-03  4.69406089e-03  4.47307900e-03
#     4.26249998e-03  4.06183442e-03  3.87061480e-03  3.68839945e-03
#     3.51476064e-03  3.34929535e-03  3.19162011e-03  3.04136728e-03
#     2.89818947e-03  2.76175025e-03  2.63173482e-03  2.50783982e-03
#     2.38977699e-03  2.27727229e-03  2.17006565e-03  2.06790445e-03
#     1.97055307e-03  1.87778450e-03  1.78938278e-03  1.70514348e-03
#     1.62487058e-03  1.54837547e-03  1.47548190e-03  1.40601990e-03
#     1.33982813e-03  1.27675233e-03  1.21664675e-03  1.15936995e-03
#     1.10478967e-03  1.05277891e-03  1.00321660e-03  9.55987780e-04
#     9.10982606e-04  8.68095958e-04  8.27228068e-04  7.88284175e-04
#     7.51173822e-04  7.15810282e-04  6.82112062e-04  6.49999885e-04
#     9.55913290e-02  5.85840084e-02  1.10641280e-02 -3.01887356e-02
#    -5.25887236e-02 -5.06420471e-02 -2.59632543e-02  1.46289207e-02
#     6.17760234e-02  1.06080636e-01  1.39919400e-01  1.58404410e-01
#     1.59586489e-01  1.44114211e-01  1.14589065e-01  7.48229772e-02
#     2.91421581e-02 -1.81776360e-02 -6.33149892e-02 -1.03144184e-01
#    -1.35342389e-01 -1.58391282e-01 -1.71509385e-01 -1.74541354e-01
#    -1.67830870e-01 -1.52090862e-01 -1.28284395e-01 -9.75215062e-02
#    -6.09742813e-02 -1.98121741e-02  2.48474050e-02  7.19709694e-02
#     1.20629229e-01  1.70007721e-01  2.19408825e-01  2.68248796e-01
#     3.16051424e-01  3.62438977e-01  4.07120794e-01  4.49883670e-01
#     4.90580887e-01  5.29121399e-01  5.65460980e-01  5.99593580e-01
#     6.31544113e-01  6.61360919e-01  6.89111173e-01  7.14875817e-01
#     7.38744915e-01  7.60814667e-01  7.81185389e-01  7.99958348e-01
#     8.17234516e-01  8.33112717e-01  8.47689390e-01  8.61057758e-01
#     8.73305917e-01  8.84518802e-01  8.94775927e-01  9.04152393e-01
#     9.12718058e-01  9.20538902e-01  9.27676439e-01  9.34186578e-01
#     9.40122366e-01  9.45532620e-01  9.50461864e-01  9.54951704e-01
#     9.59039927e-01  9.62761521e-01  9.66148853e-01  9.69231009e-01
#     9.72035050e-01  9.74585533e-01  9.76905346e-01  9.79014695e-01
#     9.80932474e-01  9.82675970e-01  9.84260976e-01  9.85701501e-01
#     9.87010837e-01  9.88200665e-01  9.89281833e-01  9.90264237e-01
#     9.91156876e-01  9.91967857e-01  9.92704630e-01  9.93373930e-01
#     9.93982017e-01  9.94534194e-01  9.95036066e-01  9.95491922e-01
#     9.95905817e-01  9.96281743e-01  9.96623278e-01  9.96933401e-01
#     9.97215152e-01  9.97470915e-01  9.97703373e-01  9.97914374e-01
#     9.98105884e-01  9.98279989e-01  9.98438060e-01  9.98581529e-01
#     9.98711884e-01  9.98830318e-01  9.98937845e-01  9.99035418e-01
#     9.99124169e-01  9.99204516e-01  9.99277830e-01  9.99343991e-01
#     9.99404371e-01  9.99459207e-01  9.99508917e-01  9.99554038e-01
#     9.99594986e-01  9.99632239e-01  9.99665976e-01  9.99696851e-01
#     9.99724627e-01  9.99749899e-01  9.99772787e-01  9.99793887e-01
#     9.99812663e-01  9.99829888e-01  9.99845684e-01  9.99859869e-01
#     9.99872625e-01  9.99884367e-01  9.99895215e-01  9.99904633e-01
#     9.99913394e-01  9.99921441e-01  9.99928594e-01  9.99935150e-01
#     9.99941111e-01  9.99946475e-01  9.99951422e-01  9.99955833e-01
#     9.99959826e-01  9.99963522e-01  9.99967098e-01  9.99970019e-01
#     9.99972820e-01  9.99975383e-01  9.99977529e-01  9.99979675e-01
#     9.99981463e-01  9.99983191e-01  9.99984741e-01  9.99985993e-01
#     9.99987423e-01  9.99988616e-01  9.99989629e-01  9.99990582e-01
#     9.99991357e-01  9.99992251e-01  9.99992907e-01  9.99993503e-01
#     9.99994159e-01  9.99994636e-01  9.99995172e-01  9.99995649e-01
#     9.99996066e-01  9.99996543e-01  9.99996722e-01  9.99996841e-01
#     9.99997258e-01  9.99997616e-01  9.99997735e-01  9.99997854e-01
#     9.99998271e-01  9.99998331e-01  9.99998450e-01  9.99998748e-01
#     9.99998808e-01  9.99998808e-01  9.99998987e-01  9.99998987e-01
#     9.99999046e-01  9.99999046e-01  9.99999344e-01  9.99999344e-01
#     9.99999464e-01  9.99999464e-01  9.99999523e-01  9.99999523e-01
#     9.99999583e-01  9.99999583e-01  9.99999821e-01  9.99999821e-01]]] (1, 1, 768)
# mean_emb[32] [[[-0.01475054 -0.01672685 -0.00483461 ...  0.9999999   1.
#     1.        ]
#   [ 0.05686374  0.00624893 -0.00402385 ...  0.9999999   1.
#     1.        ]]

#  [[-0.01475054 -0.01672685 -0.00483461 ...  0.99999934  0.99999946
#     0.99999946]
#   [ 0.05686374  0.00624893 -0.00402385 ...  0.99999934  0.99999946
#     0.99999946]]] (2, 2, 768)
# mean_emb[64] [[[ 0.5203799   0.54258305  0.56030476 ...  1.          1.
#     1.        ]
#   [-0.5498801  -0.5760373  -0.569974   ...  1.          1.
#     1.        ]
#   [ 0.5104148   0.5855245   0.5779402  ...  1.          1.
#     1.        ]
#   [-0.39668757 -0.573027   -0.5859884  ...  1.          1.
#     1.        ]]

#  [[ 0.5203799   0.54258305  0.56030476 ...  0.9999999   0.9999999
#     0.9999999 ]
#   [-0.5498801  -0.5760373  -0.569974   ...  0.9999999   0.9999999
#     0.9999999 ]
#   [ 0.5104148   0.5855245   0.5779402  ...  0.9999999   0.9999999
#     0.9999999 ]
#   [-0.39668757 -0.573027   -0.5859884  ...  0.9999999   0.9999999
#     0.9999999 ]]

#  [[ 0.5203799   0.54258305  0.56030476 ...  0.9999999   0.9999999
#     0.9999999 ]
#   [-0.5498801  -0.5760373  -0.569974   ...  0.9999999   0.9999999
#     0.9999999 ]
#   [ 0.5104148   0.5855245   0.5779402  ...  0.9999999   0.9999999
#     0.9999999 ]
#   [-0.39668757 -0.573027   -0.5859884  ...  0.9999999   0.9999999
#     0.9999999 ]]

#  [[ 0.5203799   0.54258305  0.56030476 ...  0.9999998   0.9999998
#     0.9999999 ]
#   [-0.5498801  -0.5760373  -0.569974   ...  0.9999998   0.9999998
#     0.9999999 ]
#   [ 0.5104148   0.5855245   0.5779402  ...  0.9999998   0.9999998
#     0.9999999 ]
#   [-0.39668757 -0.573027   -0.5859884  ...  0.9999998   0.9999998
#     0.9999999 ]]] (4, 4, 768)
# mean_emb[128] [[[ 0.36063045  0.3493337   0.3378482  ...  1.          1.
#     1.        ]
#   [ 0.68012875  0.7358326   0.7827617  ...  1.          1.
#     1.        ]
#   [-0.5291278  -0.41782102 -0.29417878 ...  1.          1.
#     1.        ]
#   ...
#   [ 0.22139856  0.5380147   0.75782585 ...  1.          1.
#     1.        ]
#   [-0.803511   -0.65682155 -0.3511758  ...  1.          1.
#     1.        ]
#   [ 0.01013564 -0.4892325  -0.8208004  ...  1.          1.
#     1.        ]]

#  [[ 0.36063045  0.3493337   0.3378482  ...  1.          1.
#     1.        ]
#   [ 0.68012875  0.7358326   0.7827617  ...  1.          1.
#     1.        ]
#   [-0.5291278  -0.41782102 -0.29417878 ...  1.          1.
#     1.        ]
#   ...
#   [ 0.22139856  0.5380147   0.75782585 ...  1.          1.
#     1.        ]
#   [-0.803511   -0.65682155 -0.3511758  ...  1.          1.
#     1.        ]
#   [ 0.01013564 -0.4892325  -0.8208004  ...  1.          1.
#     1.        ]]

#  [[ 0.36063045  0.3493337   0.3378482  ...  0.9999999   0.9999999
#     0.9999999 ]
#   [ 0.68012875  0.7358326   0.7827617  ...  0.9999999   0.9999999
#     0.9999999 ]
#   [-0.5291278  -0.41782102 -0.29417878 ...  0.9999999   0.9999999
#     0.9999999 ]
#   ...
#   [ 0.22139856  0.5380147   0.75782585 ...  0.9999999   0.9999999
#     0.9999999 ]
#   [-0.803511   -0.65682155 -0.3511758  ...  0.9999999   0.9999999
#     0.9999999 ]
#   [ 0.01013564 -0.4892325  -0.8208004  ...  0.9999999   0.9999999
#     0.9999999 ]]

#  ...

#  [[ 0.36063045  0.3493337   0.3378482  ...  0.9999998   0.9999998
#     0.9999998 ]
#   [ 0.68012875  0.7358326   0.7827617  ...  0.9999998   0.9999998
#     0.9999998 ]
#   [-0.5291278  -0.41782102 -0.29417878 ...  0.9999998   0.9999998
#     0.9999998 ]
#   ...
#   [ 0.22139856  0.5380147   0.75782585 ...  0.9999998   0.9999998
#     0.9999998 ]
#   [-0.803511   -0.65682155 -0.3511758  ...  0.9999998   0.9999998
#     0.9999998 ]
#   [ 0.01013564 -0.4892325  -0.8208004  ...  0.9999998   0.9999998
#     0.9999998 ]]

#  [[ 0.36063045  0.3493337   0.3378482  ...  0.99999946  0.9999995
#     0.9999995 ]
#   [ 0.68012875  0.7358326   0.7827617  ...  0.99999946  0.9999995
#     0.9999995 ]
#   [-0.5291278  -0.41782102 -0.29417878 ...  0.99999946  0.9999995
#     0.9999995 ]
#   ...
#   [ 0.22139856  0.5380147   0.75782585 ...  0.99999946  0.9999995
#     0.9999995 ]
#   [-0.803511   -0.65682155 -0.3511758  ...  0.99999946  0.9999995
#     0.9999995 ]
#   [ 0.01013564 -0.4892325  -0.8208004  ...  0.99999946  0.9999995
#     0.9999995 ]]

#  [[ 0.36063045  0.3493337   0.3378482  ...  0.99999875  0.99999934
#     0.99999934]
#   [ 0.68012875  0.7358326   0.7827617  ...  0.99999875  0.99999934
#     0.99999934]
#   [-0.5291278  -0.41782102 -0.29417878 ...  0.99999875  0.99999934
#     0.99999934]
#   ...
#   [ 0.22139856  0.5380147   0.75782585 ...  0.99999875  0.99999934
#     0.99999934]
#   [-0.803511   -0.65682155 -0.3511758  ...  0.99999875  0.99999934
#     0.99999934]
#   [ 0.01013564 -0.4892325  -0.8208004  ...  0.99999875  0.99999934
#     0.99999934]]] (8, 8, 768)
# flat_embs [[ 0.0210566  -0.00523896 -0.00442923 ...  0.9999996   0.9999998
#    0.9999998 ]
#  [-0.01475054 -0.01672685 -0.00483461 ...  0.9999999   1.
#    1.        ]
#  [ 0.05686374  0.00624893 -0.00402385 ...  0.9999999   1.
#    1.        ]
#  ...
#  [-0.9999902  -0.87106687 -0.5344832  ...  0.999999    0.99999905
#    0.99999917]
#  [-0.53657293 -0.90496594 -0.9951195  ...  0.999999    0.99999905
#    0.99999917]
#  [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#    0.99999917]] (281, 768)
