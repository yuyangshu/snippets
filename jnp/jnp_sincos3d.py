import jax.numpy as jnp


# 224 / 16
h = w = 14
# 128 / 16 -> 8, 64 / 16 -> 4, 32 / 16 -> 2, 16 / 16 -> 1
d = 5
width = 768
temperature=10_000.

# (14, 14, 5)
z, y, x = jnp.mgrid[:h, :w, :d]
print("z", z, z.shape)
print("y", y, y.shape)
print("x", x, x.shape)

# (128,)
omega = jnp.arange(width // 6) / (width // 6 - 1)
print("omega", omega, omega.shape)
omega = 1. / (temperature**omega)
print("omega again", omega, omega.shape)

# (980, 128)
z = jnp.einsum("m,d->md", z.flatten(), omega)
y = jnp.einsum("m,d->md", y.flatten(), omega)
x = jnp.einsum("m,d->md", x.flatten(), omega)
print("z", z, z.shape)
print("y", y, y.shape)
print("x", x, x.shape)

# (980, 768)
pe = jnp.concatenate([jnp.sin(x), jnp.cos(x), jnp.sin(y), jnp.cos(y), jnp.sin(z), jnp.cos(z)], axis=1)
print("pe", pe, pe.shape)

# (1, 980, 768)
emb = jnp.asarray(pe, jnp.float32)[None, :, :]
print("emb", emb, emb.shape)

# is this the correct setup tho









# z [[[ 0  0  0  0  0]
#   [ 0  0  0  0  0]
#   [ 0  0  0  0  0]
#   ...
#  [[ 1  1  1  1  1]
#   [ 1  1  1  1  1]
#   [ 1  1  1  1  1]
#   ...
#   [13 13 13 13 13]
#   [13 13 13 13 13]
#   [13 13 13 13 13]]] (14, 14, 5)

# y [[[ 0  0  0  0  0]
#   [ 1  1  1  1  1]
#   [ 2  2  2  2  2]
#   ...
#   [11 11 11 11 11]
#   [12 12 12 12 12]
#   [13 13 13 13 13]]] (14, 14, 5)

# x [[[0 1 2 3 4]
#   [0 1 2 3 4]
#   [0 1 2 3 4]
#   ...
#   [0 1 2 3 4]
#   [0 1 2 3 4]
#   [0 1 2 3 4]]] (14, 14, 5)

# omega [0.         0.00787402 0.01574803 0.02362205 0.03149606 0.03937008
#  0.04724409 0.05511811 0.06299213 0.07086614 0.07874016 0.08661418
#  0.09448819 0.1023622  0.11023622 0.11811024 0.12598425 0.13385826
#  0.14173228 0.1496063  0.15748031 0.16535433 0.17322835 0.18110237
#  0.18897638 0.19685039 0.2047244  0.21259843 0.22047244 0.22834645
#  0.23622048 0.24409449 0.2519685  0.25984251 0.26771653 0.27559054
#  0.28346455 0.2913386  0.2992126  0.30708662 0.31496063 0.32283464
#  0.33070865 0.33858266 0.3464567  0.35433072 0.36220473 0.37007874
#  0.37795275 0.38582677 0.39370078 0.4015748  0.4094488  0.41732284
#  0.42519686 0.43307087 0.44094488 0.4488189  0.4566929  0.46456692
#  0.47244096 0.48031497 0.48818898 0.496063   0.503937   0.511811
#  0.51968503 0.52755904 0.53543305 0.54330707 0.5511811  0.5590551
#  0.5669291  0.5748032  0.5826772  0.5905512  0.5984252  0.6062992
#  0.61417323 0.62204725 0.62992126 0.63779527 0.6456693  0.6535433
#  0.6614173  0.6692913  0.6771653  0.68503934 0.6929134  0.7007874
#  0.70866144 0.71653545 0.72440946 0.7322835  0.7401575  0.7480315
#  0.7559055  0.7637795  0.77165353 0.77952754 0.78740156 0.79527557
#  0.8031496  0.8110236  0.8188976  0.8267717  0.8346457  0.8425197
#  0.8503937  0.8582677  0.86614174 0.87401575 0.88188976 0.8897638
#  0.8976378  0.9055118  0.9133858  0.9212598  0.92913383 0.93700784
#  0.9448819  0.9527559  0.96062994 0.96850395 0.97637796 0.984252
#  0.992126   1.        ] (128,)

# omega again [1.00000000e+00 9.30044889e-01 8.64983559e-01 8.04473639e-01
#  7.48196661e-01 6.95856452e-01 6.47177815e-01 6.01904452e-01
#  5.59798181e-01 5.20637512e-01 4.84216273e-01 4.50342894e-01
#  4.18839127e-01 3.89539212e-01 3.62288952e-01 3.36945027e-01
#  3.13374013e-01 2.91451931e-01 2.71063417e-01 2.52101123e-01
#  2.34465361e-01 2.18063354e-01 2.02808708e-01 1.88621223e-01
#  1.75426215e-01 1.63154274e-01 1.51740819e-01 1.41125754e-01
#  1.31253302e-01 1.22071475e-01 1.13531955e-01 1.05589814e-01
#  9.82032791e-02 9.13334712e-02 8.49442333e-02 7.90019557e-02
#  7.34753758e-02 6.83353841e-02 6.35549799e-02 5.91089912e-02
#  5.49740158e-02 5.11283055e-02 4.75516245e-02 4.42251526e-02
#  4.11313735e-02 3.82540263e-02 3.55779603e-02 3.30891088e-02
#  3.07743568e-02 2.86215339e-02 2.66193133e-02 2.47571617e-02
#  2.30252743e-02 2.14145333e-02 1.99164804e-02 1.85232218e-02
#  1.72274299e-02 1.60222854e-02 1.49014443e-02 1.38590140e-02
#  1.28895026e-02 1.19878175e-02 1.11492099e-02 1.03692664e-02
#  9.64388438e-03 8.96924548e-03 8.34180228e-03 7.75825186e-03
#  7.21552223e-03 6.71075983e-03 6.24130853e-03 5.80469752e-03
#  5.39863063e-03 5.02096675e-03 4.66972450e-03 4.34305379e-03
#  4.03923541e-03 3.75667075e-03 3.49387294e-03 3.24945874e-03
#  3.02214269e-03 2.81072874e-03 2.61410396e-03 2.43123411e-03
#  2.26115738e-03 2.10297806e-03 1.95586425e-03 1.81904179e-03
#  1.69178948e-03 1.57344027e-03 1.46337040e-03 1.36100012e-03
#  1.26579136e-03 1.17724296e-03 1.09488890e-03 1.01829600e-03
#  9.47060995e-04 8.80809268e-04 8.19192268e-04 7.61885720e-04
#  7.08587933e-04 6.59018639e-04 6.12917007e-04 5.70040429e-04
#  5.30163175e-04 4.93075349e-04 4.58582275e-04 4.26502142e-04
#  3.96666146e-04 3.68917390e-04 3.43109714e-04 3.19107494e-04
#  2.96784303e-04 2.76022794e-04 2.56713625e-04 2.38755194e-04
#  2.22053073e-04 2.06519311e-04 1.92072272e-04 1.78635833e-04
#  1.66139289e-04 1.54516994e-04 1.43707759e-04 1.33654685e-04
#  1.24304875e-04 1.15609117e-04 1.07521679e-04 9.99999902e-05] (128,)

# z [[0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  [0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  [0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  ...
#  [1.30000000e+01 1.20905843e+01 1.12447868e+01 ... 1.50291867e-03
#   1.39778191e-03 1.30000000e-03]
#  [1.30000000e+01 1.20905843e+01 1.12447868e+01 ... 1.50291867e-03
#   1.39778191e-03 1.30000000e-03]
#  [1.30000000e+01 1.20905843e+01 1.12447868e+01 ... 1.50291867e-03
#   1.39778191e-03 1.30000000e-03]] (980, 128)
# y [[0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  [0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  [0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  ...
#  [1.30000000e+01 1.20905843e+01 1.12447868e+01 ... 1.50291867e-03
#   1.39778191e-03 1.30000000e-03]
#  [1.30000000e+01 1.20905843e+01 1.12447868e+01 ... 1.50291867e-03
#   1.39778191e-03 1.30000000e-03]
#  [1.30000000e+01 1.20905843e+01 1.12447868e+01 ... 1.50291867e-03
#   1.39778191e-03 1.30000000e-03]] (980, 128)
# x [[0.00000000e+00 0.00000000e+00 0.00000000e+00 ... 0.00000000e+00
#   0.00000000e+00 0.00000000e+00]
#  [1.00000000e+00 9.30044946e-01 8.64983601e-01 ... 1.15609128e-04
#   1.07521685e-04 1.00000000e-04]
#  [2.00000000e+00 1.86008989e+00 1.72996720e+00 ... 2.31218256e-04
#   2.15043371e-04 2.00000000e-04]
#  ...
#  [2.00000000e+00 1.86008989e+00 1.72996720e+00 ... 2.31218256e-04
#   2.15043371e-04 2.00000000e-04]
#  [3.00000000e+00 2.79013484e+00 2.59495080e+00 ... 3.46827384e-04
#   3.22565056e-04 3.00000000e-04]
#  [4.00000000e+00 3.72017978e+00 3.45993441e+00 ... 4.62436513e-04
#   4.30086741e-04 4.00000000e-04]] (980, 128)
# pe [[ 0.          0.          0.         ...  1.          1.
#    1.        ]
#  [ 0.84147098  0.80164681  0.76108463 ...  1.          1.
#    1.        ]
#  [ 0.90929743  0.95844564  0.98735904 ...  1.          1.
#    1.        ]
#  ...
#  [ 0.90929743  0.95844564  0.98735904 ...  0.99999887  0.99999902
#    0.99999916]
#  [ 0.14112001  0.34426688  0.51982138 ...  0.99999887  0.99999902
#    0.99999916]
#  [-0.7568025  -0.54684158 -0.31299206 ...  0.99999887  0.99999902
#    0.99999916]] (980, 768)
# emb [[[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.84147096  0.8016468   0.7610846  ...  1.          1.
#     1.        ]
#   [ 0.9092974   0.95844567  0.98735905 ...  1.          1.
#     1.        ]
#   ...
#   [ 0.9092974   0.95844567  0.98735905 ...  0.99999887  0.99999905
#     0.99999917]
#   [ 0.14112     0.34426686  0.5198214  ...  0.99999887  0.99999905
#     0.99999917]
#   [-0.7568025  -0.54684156 -0.31299207 ...  0.99999887  0.99999905
#     0.99999917]]] (1, 980, 768)
