import jax.numpy as jnp


h = w = 14
width = 768
temperature=10_000.

# (14, 14)
y, x = jnp.mgrid[:h, :w]
print("y", y, y.shape)
print("x", x, x.shape)

# (192,)
omega = jnp.arange(width // 4) / (width // 4 - 1)
print("omega", omega, omega.shape)
omega = 1. / (temperature**omega)
print("omega again", omega, omega.shape)

# (196, 192)
y = jnp.einsum("m,d->md", y.flatten(), omega)
x = jnp.einsum("m,d->md", x.flatten(), omega)
print("y", y, y.shape)
print("x", x, x.shape)

# (196, 768)
pe = jnp.concatenate([jnp.sin(x), jnp.cos(x), jnp.sin(y), jnp.cos(y)], axis=1)
print("pe", pe, pe.shape)

# (1, 196, 768)
emb = jnp.asarray(pe, jnp.float32)[None, :, :]
print("emb", emb, emb.shape)














# y [[ 0  0  0  0  0  0  0  0  0  0  0  0  0  0]
#  [ 1  1  1  1  1  1  1  1  1  1  1  1  1  1]
#  [ 2  2  2  2  2  2  2  2  2  2  2  2  2  2]
#  [ 3  3  3  3  3  3  3  3  3  3  3  3  3  3]
#  [ 4  4  4  4  4  4  4  4  4  4  4  4  4  4]
#  [ 5  5  5  5  5  5  5  5  5  5  5  5  5  5]
#  [ 6  6  6  6  6  6  6  6  6  6  6  6  6  6]
#  [ 7  7  7  7  7  7  7  7  7  7  7  7  7  7]
#  [ 8  8  8  8  8  8  8  8  8  8  8  8  8  8]
#  [ 9  9  9  9  9  9  9  9  9  9  9  9  9  9]
#  [10 10 10 10 10 10 10 10 10 10 10 10 10 10]
#  [11 11 11 11 11 11 11 11 11 11 11 11 11 11]
#  [12 12 12 12 12 12 12 12 12 12 12 12 12 12]
#  [13 13 13 13 13 13 13 13 13 13 13 13 13 13]] (14, 14)

# omega [0.         0.0052356  0.0104712  0.01570681 0.02094241 0.02617801
#  0.03141361 0.03664922 0.04188482 0.04712042 0.05235602 0.05759162
#  0.06282723 0.06806283 0.07329843 0.07853403 0.08376963 0.08900524
#  0.09424084 0.09947644 0.10471204 0.10994764 0.11518325 0.12041885
#  0.12565446 0.13089006 0.13612565 0.14136125 0.14659686 0.15183246
#  0.15706806 0.16230367 0.16753927 0.17277487 0.17801048 0.18324608
#  0.18848167 0.19371729 0.19895288 0.20418848 0.20942408 0.21465969
#  0.21989529 0.22513089 0.2303665  0.2356021  0.2408377  0.2460733
#  0.25130892 0.2565445  0.2617801  0.2670157  0.2722513  0.27748692
#  0.2827225  0.28795812 0.29319373 0.2984293  0.30366492 0.30890054
#  0.31413612 0.31937173 0.32460734 0.32984293 0.33507854 0.34031415
#  0.34554973 0.35078534 0.35602096 0.36125654 0.36649215 0.37172776
#  0.37696335 0.38219896 0.38743457 0.39267015 0.39790577 0.40314138
#  0.40837696 0.41361257 0.41884816 0.42408377 0.42931938 0.43455496
#  0.43979058 0.4450262  0.45026177 0.45549738 0.460733   0.46596858
#  0.4712042  0.4764398  0.4816754  0.486911   0.4921466  0.4973822
#  0.50261784 0.5078534  0.513089   0.5183246  0.5235602  0.52879584
#  0.5340314  0.539267   0.5445026  0.5497382  0.55497384 0.56020945
#  0.565445   0.5706806  0.57591623 0.58115184 0.58638746 0.59162307
#  0.5968586  0.60209423 0.60732985 0.61256546 0.6178011  0.6230367
#  0.62827224 0.63350785 0.63874346 0.6439791  0.6492147  0.6544503
#  0.65968585 0.66492146 0.6701571  0.6753927  0.6806283  0.68586385
#  0.69109946 0.6963351  0.7015707  0.7068063  0.7120419  0.71727747
#  0.7225131  0.7277487  0.7329843  0.7382199  0.7434555  0.7486911
#  0.7539267  0.7591623  0.7643979  0.76963353 0.77486914 0.7801047
#  0.7853403  0.7905759  0.79581153 0.80104715 0.80628276 0.8115183
#  0.8167539  0.82198954 0.82722515 0.83246076 0.8376963  0.8429319
#  0.84816754 0.85340315 0.85863876 0.8638744  0.8691099  0.87434554
#  0.87958115 0.88481677 0.8900524  0.895288   0.90052354 0.90575916
#  0.91099477 0.9162304  0.921466   0.9267016  0.93193716 0.9371728
#  0.9424084  0.947644   0.9528796  0.9581152  0.9633508  0.9685864
#  0.973822   0.9790576  0.9842932  0.98952883 0.9947644  1.        ] (192,)

# omega again [1.00000000e+00 9.52922583e-01 9.08061326e-01 8.65312099e-01
#  8.24575365e-01 7.85756469e-01 7.48765051e-01 7.13515103e-01
#  6.79924548e-01 6.47915423e-01 6.17413223e-01 5.88346958e-01
#  5.60648978e-01 5.34255147e-01 5.09103775e-01 4.85136449e-01
#  4.62297380e-01 4.40533638e-01 4.19794410e-01 4.00031567e-01
#  3.81199062e-01 3.63253206e-01 3.46152097e-01 3.29856187e-01
#  3.14327359e-01 2.99529642e-01 2.85428524e-01 2.71991283e-01
#  2.59186566e-01 2.46984750e-01 2.35357329e-01 2.24277303e-01
#  2.13718906e-01 2.03657553e-01 1.94069847e-01 1.84933528e-01
#  1.76227346e-01 1.67930990e-01 1.60025224e-01 1.52491659e-01
#  1.45312741e-01 1.38471767e-01 1.31952867e-01 1.25740871e-01
#  1.19821288e-01 1.14180423e-01 1.08805090e-01 1.03682816e-01
#  9.88016799e-02 9.41503569e-02 8.97179991e-02 8.54943097e-02
#  8.14694464e-02 7.76340663e-02 7.39792660e-02 7.04964995e-02
#  6.71776980e-02 6.40151501e-02 6.10014796e-02 5.81296682e-02
#  5.53930849e-02 5.27853072e-02 5.03003076e-02 4.79323007e-02
#  4.56757657e-02 4.35254611e-02 4.14764024e-02 3.95237952e-02
#  3.76631059e-02 3.58900316e-02 3.42004150e-02 3.25903445e-02
#  3.10560763e-02 2.95940321e-02 2.82008182e-02 2.68731993e-02
#  2.56080758e-02 2.44025085e-02 2.32537035e-02 2.21589766e-02
#  2.11157911e-02 2.01217104e-02 1.91744324e-02 1.82717498e-02
#  1.74115617e-02 1.65918656e-02 1.58107672e-02 1.50664346e-02
#  1.43571412e-02 1.36812478e-02 1.30371684e-02 1.24234091e-02
#  1.18385479e-02 1.12812174e-02 1.07501261e-02 1.02440389e-02
#  9.76177119e-03 9.30221658e-03 8.86429101e-03 8.44698213e-03
#  8.04931857e-03 7.67037645e-03 7.30927754e-03 6.96517434e-03
#  6.63727056e-03 6.32480392e-03 6.02704799e-03 5.74330939e-03
#  5.47293108e-03 5.21527883e-03 4.96975612e-03 4.73579252e-03
#  4.51284228e-03 4.30038897e-03 4.09793900e-03 3.90501856e-03
#  3.72117967e-03 3.54599534e-03 3.37905856e-03 3.21998051e-03
#  3.06839356e-03 2.92394124e-03 2.78628897e-03 2.65511707e-03
#  2.53012078e-03 2.41100905e-03 2.29750574e-03 2.18934473e-03
#  2.08627572e-03 1.98805891e-03 1.89446611e-03 1.80528010e-03
#  1.72029191e-03 1.63930468e-03 1.56213029e-03 1.48858898e-03
#  1.41850987e-03 1.35173055e-03 1.28809444e-03 1.22745405e-03
#  1.16966851e-03 1.11460325e-03 1.06213056e-03 1.01212854e-03
#  9.64479987e-04 9.19074519e-04 8.75806785e-04 8.34575971e-04
#  7.95286149e-04 7.57846399e-04 7.22168828e-04 6.88170956e-04
#  6.55773503e-04 6.24901266e-04 5.95482416e-04 5.67448908e-04
#  5.40734793e-04 5.15278312e-04 4.91020270e-04 4.67904232e-04
#  4.45876678e-04 4.24885860e-04 4.04883322e-04 3.85822379e-04
#  3.67658795e-04 3.50350310e-04 3.33856820e-04 3.18139675e-04
#  3.03162436e-04 2.88890296e-04 2.75290018e-04 2.62330053e-04
#  2.49980338e-04 2.38211855e-04 2.26997392e-04 2.16310917e-04
#  2.06127545e-04 1.96423556e-04 1.87176527e-04 1.78364702e-04
#  1.69967723e-04 1.61966062e-04 1.54341091e-04 1.47075101e-04
#  1.40151227e-04 1.33553258e-04 1.27265899e-04 1.21274512e-04
#  1.15565213e-04 1.10124682e-04 1.04940336e-04 9.99999902e-05] (192,)

# y [[0.0000000e+00 0.0000000e+00 0.0000000e+00 ... 0.0000000e+00
#   0.0000000e+00 0.0000000e+00]
#  [0.0000000e+00 0.0000000e+00 0.0000000e+00 ... 0.0000000e+00
#   0.0000000e+00 0.0000000e+00]
#  [0.0000000e+00 0.0000000e+00 0.0000000e+00 ... 0.0000000e+00
#   0.0000000e+00 0.0000000e+00]
#  ...
#  [1.3000000e+01 1.2387994e+01 1.1804797e+01 ... 1.4316209e-03
#   1.3642244e-03 1.2999999e-03]
#  [1.3000000e+01 1.2387994e+01 1.1804797e+01 ... 1.4316209e-03
#   1.3642244e-03 1.2999999e-03]
#  [1.3000000e+01 1.2387994e+01 1.1804797e+01 ... 1.4316209e-03
#   1.3642244e-03 1.2999999e-03]] (196, 192)

# pe [[ 0.          0.          0.         ...  1.          1.
#    1.        ]
#  [ 0.841471    0.81511205  0.78831244 ...  1.          1.
#    1.        ]
#  [ 0.90929747  0.9443943   0.97005814 ...  1.          1.
#    1.        ]
#  ...
#  [-0.9999902  -0.87106687 -0.5344832  ...  0.999999    0.99999905
#    0.99999917]
#  [-0.53657293 -0.90496594 -0.9951195  ...  0.999999    0.99999905
#    0.99999917]
#  [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#    0.99999917]] (196, 768)

# emb [[[ 0.          0.          0.         ...  1.          1.
#     1.        ]
#   [ 0.841471    0.81511205  0.78831244 ...  1.          1.
#     1.        ]
#   [ 0.90929747  0.9443943   0.97005814 ...  1.          1.
#     1.        ]
#   ...
#   [-0.9999902  -0.87106687 -0.5344832  ...  0.999999    0.99999905
#     0.99999917]
#   [-0.53657293 -0.90496594 -0.9951195  ...  0.999999    0.99999905
#     0.99999917]
#   [ 0.42016706 -0.17743237 -0.6900611  ...  0.999999    0.99999905
#     0.99999917]]] (1, 196, 768)
