import jax.numpy as jnp
import jax.lax as lax


# (4, 4, 3)
A = jnp.array([[[1, 2, 3], [2, 4, 6], [3, 6, 9], [4, 8, 12]],
               [[2, 3, 4], [4, 6, 8], [6, 9, 12], [8, 12, 16]],
               [[3, 4, 5], [6, 9, 12], [9, 12, 15], [12, 16, 20]],
               [[4, 5, 6], [8, 12, 16], [12, 16, 20], [16, 20, 24]]])

# submatrix and mean
input_size = 4
field_size = 2
stride = 1

for i in range(0, input_size - field_size + 1, stride):
    for j in range(0, input_size - field_size + 1, stride):
        patch = lax.dynamic_slice(A, (i, j, 0), (field_size, field_size, 3))
        print(i, j, patch, patch.mean(axis=(0, 1)))










# 0 0 [[[1 2 3]
#   [2 4 6]]

#  [[2 3 4]
#   [4 6 8]]] [2.25 3.75 5.25]
# 0 1 [[[ 2  4  6]
#   [ 3  6  9]]

#  [[ 4  6  8]
#   [ 6  9 12]]] [3.75 6.25 8.75]
# 0 2 [[[ 3  6  9]
#   [ 4  8 12]]

#  [[ 6  9 12]
#   [ 8 12 16]]] [ 5.25  8.75 12.25]
# 1 0 [[[ 2  3  4]
#   [ 4  6  8]]

#  [[ 3  4  5]
#   [ 6  9 12]]] [3.75 5.5  7.25]
# 1 1 [[[ 4  6  8]
#   [ 6  9 12]]

#  [[ 6  9 12]
#   [ 9 12 15]]] [ 6.25  9.   11.75]
# 1 2 [[[ 6  9 12]
#   [ 8 12 16]]

#  [[ 9 12 15]
#   [12 16 20]]] [ 8.75 12.25 15.75]
# 2 0 [[[ 3  4  5]
#   [ 6  9 12]]

#  [[ 4  5  6]
#   [ 8 12 16]]] [5.25 7.5  9.75]
# 2 1 [[[ 6  9 12]
#   [ 9 12 15]]

#  [[ 8 12 16]
#   [12 16 20]]] [ 8.75 12.25 15.75]
# 2 2 [[[ 9 12 15]
#   [12 16 20]]

#  [[12 16 20]
#   [16 20 24]]] [12.25 16.   19.75]